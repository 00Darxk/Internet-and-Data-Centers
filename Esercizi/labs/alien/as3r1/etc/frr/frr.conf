!
! FRRouting configuration file
!
!  README: 
!  - titolo delle (sotto)sezioni in maiuscolo
!  - valori di default tra parentesi tonde (default)
!  - valori da inserire tra parentesi graffe {valore}
!       - possono essere specificate opzioni {valore: opzione1, opzione2, opzione3}
!       - tra queste bisogna sceglierne solo una
!  - parametri/comandi opzionali tra parentesi quadre [opzionale] 
!       - se non ci sono si assume sia necessario
!  - evitare di lasciare commenti (!) sparsi tra le righe o dopo un comando,
!       - potrebbero impedire di leggere righe adiacenti
! 
! CONFIGURARE INTERFACCE:
!   interface {nome-interfaccia}
!   {protocollo: ospf} cost {costo: (10), {intero}}
!
! CONFIGURARE PROTOCOLLI DI INSTRADAMENTO:
!   router {protocollo: rip, ospf, bgp {as-id}}
!
!   PROTOCOLLI IGP: 
!       OSPF:
!           network {prefisso}/{netmask} area {area-id}
!           [area {area-id} {area-type: (backbone), stub} {option: no-summary}]
!           [default-information originate always]
!
!       RIP:
!           network {prefisso}/{netmask}
!           route   {prefisso}/{netmask}
!
!       redistribute {tabella: kernel, connected, bgp [route-map {nome-rmap}]} 
!   
!   PROTOCOLLI EGP:
!       OPZIONI DI DEBUG BGP:
!          [debug bgp keepalives]
!          [debug bgp updates in]
!          [debug bgp updates out]
!       OPZIONI ZEBRA:
!           [password zebra]
!           [enable password zebra]
!
!       BGP:
!           [no bgp network import-check]
!           [no bgp ebgp-requires-policy] 
!           neighbor  {indirizzo-peer} remote-as {as-di-peer}
!           [neighbor {indirizzo-peer} description {descrizione}]
!           [neighbor {indirizzo-peer} prefix-list {nome-lista} {tipo: in, out}]
!           [neighbor {indirizzo-peer} filter-list {nome-lista} {tipo: in, out}]
!           [neighbor {indirizzo-peer} [default-originate] route-map {nome-rmap} {tipo: in, out}]
!           [neighbor {indirizzo-peer} update-source {prefisso}/{netmask}]
!           [neighbor {indirizzo-peer} default-originate]
!
!           [access-list {nome-lista} [exact-match] permit {prefisso}/{netmask}]
!
!           [ip address prefix-list {nome-lista} [seq {seq-num}] permit {(any), {prefisso}/{netmask}}]
!
!           network {prefisso}/{netmask}
!           [redistribute {tabella: connected}]
!
!           
!           [route-map {{nome-lista}, {nome-rmap}} {tipo: permit/deny} {seq-num}
!               [match ip address {indirizzo}]
!               [match ip access-list {nome-l}]
!               [match ip address prefix-list {nome-l}]
!               [match ip next-hop {address {indirizzo}, prefix-list {nome-l}, access-list {nome-l}}]
!               [match ip origin {address {indirizzo}, prefix-list {nome-l}, access-list {nome-l}}]
!               [match as-path {path}]
!               [set {parametro: local-preference, metric, origin, next-hop} {valore}]
!           ]
!           
!           [bgp as-path access-list {nome-filter/access-list} {tipo: permit, deny} {regexp}]
!
!
!
! CONFIGURARE LOG: 
!   

router rip 
    network 3.3.0.0/24
    redistribute connected
    redistribute bgp

debug bgp keepalives
debug bgp updates in
debug bgp updates out

password zebra
enable password zebra

router bgp 3
    no bgp network import-check
    no bgp ebgp-requires-policy

    neighbor 1.3.0.1 remote-as 1
    neighbor 1.3.0.1 description AS1(r1)
    neighbor 3.3.0.2 remote-as 3
    neighbor 3.3.0.2 description AS3(as3r2)
    neighbor 3.4.0.2 remote-as 4
    neighbor 3.4.0.2 description AS4(r4)

    neighbor 3.4.0.2 route-map communityInAS4 in
    neighbor 3.3.0.2 route-map communityInAS5 in
    neighbor 1.3.0.1 route-map communityOutAS1 out

    network 1.3.0.0/30
    network 3.3.0.0/24
    network 3.4.0.0/30

    ip prefix-list prefixCommunity1 seq 5 permit 4.4.1.0/24 le 32
    ip prefix-list prefixCommunity1 seq 10 permit 5.5.1.0/24 le 32
    
    ip prefix-list prefixCommunity2 seq 5 permit 4.4.2.0/24 le 32
    ip prefix-list prefixCommunity2 seq 10 permit 5.5.2.0/24 le 32

    bgp community-list standard community1 permit 3:1
    bgp community-list standard community2 permit 3:2

    route-map communityInAS4 permit 5
        match ip address prefix-list prefixCommunity1
        set community 3:1

    route-map communityInAS4 permit 10
        match ip address prefix-list prefixCommunity2
        set community 3:2

    route-map communityInAS4 permit 15


    route-map communityInAS5 permit 5
        match ip address prefix-list prefixCommunity1
        set community 3:1

    route-map communityInAS5 permit 10
        match ip address prefix-list prefixCommunity2
        set community 3:2

    route-map communityInAS5 permit 15


    route-map communityOutAS1 deny 5
        match community community1
    
    route-map communityOutAS1 permit 10

log file /var/log/frr/frr.log
